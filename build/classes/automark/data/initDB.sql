drop table if exists classes;

drop table if exists answer;

drop table if exists exam;

drop table if exists examdo;

drop table if exists examdodetail;

drop table if exists judgegrant;

drop table if exists judgetype;

drop table if exists makepaper;

drop table if exists paper;

drop table if exists question;

drop table if exists questiontype;

drop table if exists study;

drop table if exists teach;

drop table if exists user;


/*==============================================================*/
/* Table: classes                                               */
/*==============================================================*/
create table classes
(
   cid   integer generated by default as identity(start with 1,increment by 1)  not null,
   name  varchar(20),
   primary key (cid)
);

/*==============================================================*/
/* Table: answer                                                */
/*==============================================================*/
create table answer
(
   aid                  integer generated by default as identity(start with 1,increment by 1)  not null,
   qid                  integer,
   input                longvarchar,
   output               longvarchar,
   primary key (aid)
);

/*==============================================================*/
/* Table: exam                                                  */
/*==============================================================*/
create table exam
(
   eid                  integer generated by default as identity(start with 1,increment by 1)  not null,
   pid                  integer,
   uid					integer,
   type                 integer,/*1 平时测试，2 统考*/
   starttime            datetime,
   endtime              datetime,
   title                varchar(50),
   primary key (eid)
);

/*==============================================================*/
/* Table: examdo                                                */
/*==============================================================*/
create table examdo
(
   edid                 integer generated by default as identity(start with 1,increment by 1)  not null,
   uid                  integer,
   eid                  integer,
   nowstatus            integer,/* 0 未提交  -1 待批阅（可修改） -2 完成  >0 当前试题 */
   totalgrade			integer,/* 0 */
   primary key (edid)
);

/*==============================================================*/
/* Table: examdodetail                                          */
/*==============================================================*/
create table examdodetail
(
   edtid                integer generated by default as identity(start with 1,increment by 1)  not null,
   mpid                 integer,
   edid                 integer,
   stuanswer            longvarchar,
   answertype           integer,
   answertime           datetime,
   autograde            integer,
   autoresult           longvarchar,
   teacherverify        integer,
   primary key (edtid)
);

/*==============================================================*/
/* Table: judgegrant                                            */
/*==============================================================*/
create table judgegrant
(
   jgid                 integer generated by default as identity(start with 1,increment by 1)  not null ,
   uid                  integer,
   eid                  integer,
   primary key (jgid)
);

/*==============================================================*/
/* Table: judgetype                                             */
/*==============================================================*/
create table judgetype
(
   jtid                 integer generated by default as identity(start with 1,increment by 1)  not null ,
   jtname               varchar(20),
   primary key (jtid)
);

/*==============================================================*/
/* Table: makepaper                                             */
/*==============================================================*/
create table makepaper
(
   mpid                 integer generated by default as identity(start with 1,increment by 1)  not null ,
   pid                  integer,
   qid                  integer,
   score                integer,
   primary key (mpid)
);

/*==============================================================*/
/* Table: paper                                                 */
/*==============================================================*/
create table paper
(
   pid                  integer generated by default as identity(start with 1,increment by 1)  not null ,
   uid                  integer,
   readgrant            integer,
   title                varchar(100),
   totalscore           integer,
   primary key (pid)
);

/*==============================================================*/
/* Table: question                                              */
/*==============================================================*/
create table question
(
   qid                  integer generated by default as identity(start with 1,increment by 1)  not null ,
   uid                  integer,
   qtid                 integer,
   jtid                 integer,
   readgrant            integer,
   title                varchar(100),
   description          longvarchar,
   primary key (qid)
);

/*==============================================================*/
/* Table: questiontype                                          */
/*==============================================================*/
create table questiontype
(
   qtid                 integer generated by default as identity(start with 1,increment by 1)  not null ,
   qtname               varchar(20),
   primary key (qtid)
);

/*==============================================================*/
/* Table: study                                                 */
/*==============================================================*/
create table study
(
   sid                  integer generated by default as identity(start with 1,increment by 1)  not null ,
   uid                  integer,
   cid                  integer,
   primary key (sid)
);

/*==============================================================*/
/* Table: teach                                                 */
/*==============================================================*/
create table teach
(
   tid                  integer generated by default as identity(start with 1,increment by 1)  not null ,
   uid                  integer,
   cid                  integer,
   course               varchar(50),
   primary key (tid)
);

/*==============================================================*/
/* Table: user                                                  */
/*==============================================================*/
create table user
(
   uid                  integer generated by default as identity(start with 1,increment by 1)  not null ,
   account              varchar(8) not null,
   password             varchar(15) not null,
   type                 integer not null,
   name                 varchar(20) not null,
   primary key (uid)
);

alter table answer add constraint FK_Reference_14 foreign key (qid)
      references question (qid) on delete cascade on update restrict;

alter table exam add constraint FK_paper_pid_exam foreign key (pid)
      references paper (pid) on delete cascade on update restrict;

alter table examdo add constraint FK_exam_eid_doexam foreign key (eid)
      references exam (eid) on delete cascade on update restrict;

alter table examdo add constraint FK_user_uid_doexam foreign key (uid)
      references user (uid) on delete cascade on update restrict;

alter table examdodetail add constraint FK_examdo_edid_doexamdetail foreign key (edid)
      references examdo (edid) on delete cascade on update restrict;

alter table examdodetail add constraint FK_makepaper_mpid_doexamdetail foreign key (mpid)
      references makepaper (mpid) on delete cascade on update restrict;

alter table judgegrant add constraint FK_exam_eid_judgegrannt foreign key (eid)
      references exam (eid) on delete cascade on update restrict;

alter table judgegrant add constraint FK_user_uid_judgegrant foreign key (uid)
      references user (uid) on delete cascade on update restrict;

alter table makepaper add constraint FK_paper_pid_makepaper foreign key (pid)
      references paper (pid) on delete cascade on update restrict;

alter table makepaper add constraint FK_question_qid_makepaper foreign key (qid)
      references question (qid) on delete cascade on update restrict;

alter table paper add constraint FK_user_uid_paper foreign key (uid)
      references user (uid) on delete cascade on update restrict;

alter table question add constraint FK_judgetype_jtid_question foreign key (jtid)
      references judgetype (jtid) on delete cascade on update restrict;

alter table question add constraint FK_questiontype_qtid_question foreign key (qtid)
      references questiontype (qtid) on delete cascade on update restrict;

alter table question add constraint FK_user_uid_question foreign key (uid)
      references user (uid) on delete cascade on update restrict;

alter table study add constraint FK_classes_cid_learn foreign key (cid)
      references classes (cid) on delete cascade on update restrict;

alter table study add constraint FK_user_uid_learn foreign key (uid)
      references user (uid) on delete cascade on update restrict;

alter table teach add constraint FK_classes_cid_teach foreign key (cid)
      references classes (cid) on delete cascade on update restrict;

alter table teach add constraint FK_user_uid_teach foreign key (uid)
      references user (uid) on delete cascade on update restrict;
